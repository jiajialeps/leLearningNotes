(window.ESL_define||define)("ecamd/openservice/passport",["require"],function(require){function e(){if(void 0!==window.bds)return"pc";else return"wise"}function t(){if(window.passport&&o)o.show();else i.getScript("//passport.baidu.com/passApi/js/uni_login_wrapper.js?cdnversion="+(new Date).getTime()).done(function(e,t){o=window.passport.pop.init(s),o.show()})}function r(){location.href="//wappass.baidu.com/passport/login?u="+encodeURIComponent(location.href)+"&tpl="+a+"&from=&uid=&pu=&bd_page_type=&tn=&regtype="}function n(){if("pc"===e())t();else r()}var o,i=window.ECMA_zepto||window.$,a="openservice",s={apiOpt:{staticPage:location.protocol+"//www.baidu.com/cache/user/html/v3Jump.html",product:a,u:location.href,memberPass:!0,safeFlag:0},authsite:[],cache:!1,tangram:!0,onLoginSuccess:function(e){location.reload(!0)}};return{login:n}}),(window.ESL_define||define)("ecamd/openservice/authorize",["require","./service","./util"],function(require){function e(e,t,r,n){var i=o.getHost().replace(/\/$/,"")+"/"+d.replace(/^\//,"").replace(/\$\{appid\}/,e)+"?"+c+"="+r;return(window.OPEN_SERVICE_API_CONFIG&&window.OPEN_SERVICE_API_CONFIG.OPEN_API_URL||s).replace(/\$\{appKey\}/,t).replace(/\$\{display\}/,n).replace(/\$\{url\}/,encodeURIComponent(i))}function t(e,t){if(u[t]){var r=u[t];if(delete u[t],0===e.code){var n={};n=a.extend(n,i.pick(r,["headers","query","success","error","contentType","deferred"])),r.service.request[r.type](r.urlId,r.originalData,n)}else{var o={msg:e.msg,httpCode:e.httpCode};if(r.error)r.error&&r.error(o);r.deferred.reject(o)}r.oaWin.close()}}function r(e){if(0===o.getHost().indexOf(e.origin)){try{var r=a.parseJSON(e.data)}catch(e){}if("object"==typeof r&&r.__osAuthorityCallback__){var n=r.__osAuthorityCallback__;t(r.data,n)}}}function n(n,o){var a=i.getActionId(),s="open_service_callback_"+a,c=e(o.appid,n,s,p);if(u[s]=o,!f)if(window.postMessage){if(window.addEventListener)window.addEventListener("message",r,!1);else if(window.attachEvent)window.attachEvent("onmessage",r)}else navigator.__osAuthorityCallback__=t;f=!0;var d=window.open(c,"authorize","height=500,width=800,toolbar=no,menubar=no,location=no");if(!d)alert("授权窗口被浏览器拦截了");o.oaWin=d}var o=require("./service"),i=require("./util"),a=window.ECMA_zepto||window.$,s="https://openapi.baidu.com/oauth/2.0/authorize?response_type=code&scope=basic&display=${display}&client_id=${appKey}&redirect_uri=${url}",c="__osCallback__",d="/api/oauth_proxy/${appid}/callback",p="page",u=window.OPEN_SERVICE_CONTEXT||{},f=!1;return{forwardToOpenApi:n,dispose:function(){if(f)if(window.postMessage){if(window.removeEventListener)window.removeEventListener("message",r);else if(window.detachEvent)window.detachEvent("onmessage",r)}else navigator.__osAuthorityCallback__=null;f=!1}}}),(window.ESL_define||define)("ecamd/openservice/cors",["require"],function(require){function e(e,o,i,a){if(!n)throw new Error("your browser do not support CORS XMLHttpRequest.");var s=new XMLHttpRequest,c=new r.Deferred;return e=e.toUpperCase(),o=o+(o.indexOf("?")>=0?"&":"?")+"__osJsonMode__=1",s.open(e,o),t(s,a),s.addEventListener("readystatechange",function(e){if(4===s.readyState){var t=s.response;if("string"==typeof t)try{t=JSON.parse(t)}catch(e){}c.resolve(t)}}),s.addEventListener("error",function(e){c.reject(e)}),s.send("GET"===e?null:i),c.promise()}function t(e,t){t=t||{responseType:"json"};var r=null==t.responseType?"json":t.responseType;if(e.responseType=r,t.headers)for(var n in t.headers)e.setRequestHeader(n,t.headers[n]);return e}var r=window.ECMA_zepto||window.$,n=window.XMLHttpRequest?"withCredentials"in new XMLHttpRequest:!1;return{isSupportCORS:n,makeCORSRequest:e}}),(window.ESL_define||define)("ecamd/openservice/postIframe",["require","./util"],function(require){function e(e,t){if(f=f||{},f[e])f[e]=t}function t(e){return!(!f||!f[e])}function r(e){if(f)return f[e]}function n(e){if(f)delete f[e]}function o(e,t,r,n){var o=d.getActionId(),a=u+o;t=t+(t.indexOf("?")>=0?"&":"?")+"callback="+encodeURIComponent(a);var s=p(document.body),c={deferred:new p.Deferred,host:t.split("/")[0],iframeId:u+"iframe-"+o,originalOption:n},f=u+"form-"+o,w=n.enctype||"application/x-www-form-urlencoded",m="";for(var v in r)m+='<input type="hidden" name="'+v+'" value="'+r[v]+'" />';return s.append('<iframe style="display:none" src="about:blank" id="'+c.iframeId+'" name="'+c.iframeId+'"></iframe><form style="display:none" method="post" id="'+f+'" target="'+c.iframeId+'" enctype="'+w+'" action="'+t+'" accept-charset="utf-8">'+m+"</form>"),l[a]=c,i(e),p("#"+f).submit(),setTimeout(function(){p("#"+f).remove()}),c.deferred.promise()}function i(r){if(!t(r))if(window.postMessage){var n=function(e){a(e,r)};if(window.addEventListener)window.addEventListener("message",n,!1),e(r,n);else if(window.attachEvent)window.attachEvent("onmessage",n),e(r,n)}else navigator[r]=s,e(r,s)}function a(e,t){try{var r=p.parseJSON(e.data)}catch(e){}if("object"==typeof r){var n=r[t],o=l[n];if(o&&0===o.host.indexOf(e.origin))delete l[n],c(r.data,o)}}function s(e,t){var r=l[t];if(r)c(e,r)}function c(e,t){p("#"+t.iframeId).remove(),t.deferred.resolve(e)}var d=require("./util"),p=window.ECMA_zepto||window.$,u="post-via-iframe-",f=null,l={};return{use:function(e){return{postViaIframe:function(t,r,n){return o(e,t,r,n)},dispose:function(){var t=r(e);if(t)if(window.postMessage){if(window.removeEventListener)window.removeEventListener("message",t,!1),n(e);else if(window.detachEvent)window.detachEvent("onmessage",t),n(e)}else navigator[e]=null,n(e)}}},commonHandler:function(e,t){if(0===e.code)p.isFunction(t.onSuccess)&&t.onSuccess(e),t.deferred.resolve(e);else p.isFunction(t.onError)&&t.onError(e),t.deferred.reject(e)}}}),(window.ESL_define||define)("ecamd/openservice/request",["require","./service","./util","./cors","./postIframe","./passport","./authorize"],function(require){function e(e,t,r,n,o){n=n||{};var i=p.getHost()+p.apiPath+"?apiKey="+encodeURIComponent((n.appid||e.appid)+"_"+t.replace(/^\//,"").replace(/\?.*$/,"")),a=e.runtime,s={__osInfoParam__:u.stringify({mcid:a.mcid,query:a.QUERY,searchTime:a.searchTime})},c=!1===o?"":h+"=?&";return r=r&&!l.isEmptyObject(r)?"&"+l.param(r):"",i+="&"+c+l.param(s)+r}function t(e,t){return n(t,e)}function r(e,t,r){return n({code:g.error,msg:"系统繁忙，请稍后再试"},e)}function n(e,t){if(_[t]){var r=_[t];delete _[t],o(e,r)}}function o(e,t){var r=e.code,n=e.httpCode,o=e.msg,i=e.result;if(g.success===r){var a={result:i,httpCode:n};l.isFunction(t.success)&&t.success(a),t.deferred.resolve(a)}else if(-1!==l.inArray(r,E))switch(r){case g.needLogin:var s=require("./passport");s.login();break;case g.needAuthority:var c=require("./authorize");c.forwardToOpenApi(l.parseJSON(i).appKey,t)}else{var d={msg:o,detailMsg:e.detailMsg,httpCode:n};l.isFunction(t.error)&&t.error(d),t.deferred.reject(d)}}function i(t,r,n,i){if(!r)throw new Error("缺少接口路径!");if(n=n||{},i=i||{},l.isFunction(n))i={success:n},n={};else if(l.isFunction(i))i={success:i};else if("object"==typeof i&&"object"==typeof i.headers&&!l.isEmptyObject(i.headers))i.query=i.query||{},i.query.__osExtHeader__=u.stringify(i.headers);i.appid=i.appid||this.appid,i.urlId=r,i.type=t,i.service=this,i.originalData=n;var d=i.deferred||new l.Deferred;if(i.deferred=d,f.isSupportCORS){var p=null,w=i.contentType||y[0];if("get"===t)p=e(this,r,l.extend({},n,i.query||{}),i,!1);else p=e(this,r,i.query||{},i,!1),n=s(n,w),n="data="+encodeURIComponent(n)+"&contentType="+encodeURIComponent(w);f.makeCORSRequest(t,p,n,{headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(e){return o(e,i)},function(){return o({code:g.error,msg:"系统繁忙，请稍后再试"},i)})}else if("get"===t)a(this,r,n,i);else c(this,r,n,i);return d.promise()}function a(n,o,i,a){var s=u.getActionId(),c="open_service_callback_"+s;_[c]=a;var d=e(n,o,l.extend({},i,a.query||{}),a);l.ajax({url:d,dataType:"jsonp",jsonp:h,cache:!0}).done(l.proxy(t,null,c)).fail(l.proxy(r,null,c))}function s(e,t){if(t=t||y[0],-1===l.inArray(t,y))throw new Error("ContentType is not allow!");if("text/xml"===t){if("string"!=typeof(e=l.isEmptyObject(e)?"":e))throw new Error("Content-type is text/xml but data is not!")}else e=u.stringify(e);return e}function c(t,r,n,i){n=s(n,i.contentType);var a=e(t,r,i.query||{},i,!1);m.postViaIframe(a,{data:u.htmlEncode(n),contentType:i.contentType},i).then(function(e){o(e,i)})}function d(e,t,r){if(r=l.extend({},this.extOptions.request,r),t=t||r.imageEncodeType,e&&t){e=encodeURI(l.trim(e));var n=/^http:\/\/(ecm[a-c]\.bdimg\.com)/,o=e.match(n);if(o){var i=o[1];return e.replace(n,this.runtime.HOSTMAP[i])}var a=r.appid||this.appid,s=this.runtime.mcid,c="ecm"+["a","b","c"][Math.floor(3*Math.random())]+".bdimg.com",d=this.runtime.HOSTMAP[c],p=e.match(/(\.[^\/.?#]+)(?:\?|#|$)/)||[],f=p[1];switch(t){case"cdn":return b+"/"+u.btoa(e)+"_"+s+f+"?appid="+a;case"bos":for(var w=u.btoa(e).replace(/\+/g,"A_").replace(/\//g,"B_").replace(/=/g,"C_"),m=w.split(""),h=0,_=m.length;h<Math.floor(_/250);h++)m.splice(250*(h+1)+h,0,"/D");return d+"/"+v+"/"+m.join("")+f}}}var p=require("./service"),u=require("./util"),f=require("./cors"),l=window.ECMA_zepto||window.$,w=require("./postIframe"),m=w.use("__osPostCallback__"),v=window.OPEN_SERVICE_API_CONFIG&&window.OPEN_SERVICE_API_CONFIG.IMAGE_BUCKET||"muses-be-image",h="__osCallback__",_={},y=["application/x-www-form-urlencoded","multipart/form-data","application/json","text/xml"],g={success:0,error:-1,badRequest:40001,accessLimit:40002,badCase:40003,needLogin:40051,serviceNotFound:40101,serviceError:40102,serviceAbort:40103,serviceFail:40104,needAuthority:40201,noAuthority:40202,authorizeFail:40211,tokenError:40212,codeError:40213,formatError:40214},E=[40051,40201],b="https://gss3.bdstatic.com/5aAHeD3nKgkZkda68IqW0jdnxx1xbK/static";p.extend("request",{get:function(e,t,r){return i.call(this,"get",e,t,r)},post:function(e,t,r){return i.call(this,"post",e,t,r)},encodeImgUrl:d,dispose:function(){m.dispose()}})});